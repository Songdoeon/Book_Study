## 🌈 Chapter 6 : 전송 계층 : 신뢰할 수 있는 데이터 전송하기

### 📚 LESSEN 23 : 전송 계층의 역할
---
네트워크 계층이 하는 역할이 있는 것처럼 전송 계층도 하는 역할이 있다.

이번에는 전송 계층의 역할에 대해 알아보자.

#### 🎈 전송 계층

네트워크 전송 중에는 라우팅 문제나 패킷의 손상 등 많은 이유로 데이터가 유실될 수 있다.

전송 계층은 목적지에 신뢰할 수 있는 데이터가 전달되도록 하는 역할을 한다.

전송 계층의 기능은 다음과 같다.

- 오류 점검하고 발생시 데이터 재전송을 요청한다.
- 전송된 데이터의 목적지가 어떤 애플리케이션인지 식별한다.
  - 데이터가 홈페이지에 사용하는 데이터인지 프로그램에 사용하는 데이터인지 등
    
#### 🎈 연결형 통신과 비연결형 통신
전송 계층의 특징을 간단히 설명하면 다음과 같다.

- 신뢰성/정확성
  - 데이터를 목적지에 문제없이 전달
  - 연결형 통신(TCP)
- 효율성
  - 데이터를 빠르고 효율적으로 전달
  - 비연결형 통신(UDP)
  - Ex)영상 통신

### 📚 LESSEN 24 : TCP의 구조
---
신뢰성과 정호가성을 우선으로 하는 연결형 통신 TCP에 대해 알아보자.

- 캡슐화
  - 응용 계층부터 물리 계층까지 계층별로 데이터를 전달할 때 헤더를 붙이는 것
- 역캡슐화
  - 캡슐화와 반대로 데이터 수신측에서 물리 계층부터 응용 계층까지 계층별 데이터를 헤더를 제거하는 것

전송 계층에서는 데이터에 TCP 헤더를 붙인다 이를 세그먼트(segment)라고 한다.

- 응용 계층: 데이터
- 전송 계층: TCP 헤더가 추가된 세그먼트
- 네트워크 계층: IP 헤더가 추가된 IP 패킷
- 데이터 링크 계층: 이더넷 헤더가 추가된 프레임
- 물리 계층: 비트

TCP는 연결형 통신으로 먼저 연결을 통새 데이터 통신로를 확보한 이후 데이터를 전송한다.

    
#### 🎈 연결 요청

<img src = "https://github.com/Songdoeon/Book_Study/assets/96420547/1481516a-b505-4340-a442-c9b7399b18bc" width = 600 height = 500>

- 연결 확립 요청
  
|URG|ACK|PSH|RST|SYN|FIN|
|--|--|--|--|--|--|
|0|0|0|0|1|0|

- 연결 확립 응답 + 연결 확립 요청

|URG|ACK|PSH|RST|SYN|FIN|
|--|--|--|--|--|--|
|0|1|0|0|1|0|

- 연결 확립 응답

|URG|ACK|PSH|RST|SYN|FIN|
|--|--|--|--|--|--|
|0|1|0|0|0|0|


#### 🎈 종료 요청

<img src = "https://github.com/Songdoeon/Book_Study/assets/96420547/a3bcc9dd-6a59-4031-812d-e618a45cc4a3" width = 600 height = 500>

- 연결 종료 요청
  
|URG|ACK|PSH|RST|SYN|FIN|
|--|--|--|--|--|--|
|0|0|0|0|0|1|

- 연결 종료 응답

|URG|ACK|PSH|RST|SYN|FIN|
|--|--|--|--|--|--|
|0|1|0|0|0|0|

### 📚 LESSEN 25 : 일련번호와 확인 응답 번호의 구조
---
3-way 핸드셰이크 이후 데이터 전송에 사용되는 TCP 헤더의 일련번호와 확인 응답 번호에 대해 알아보자.

#### 🎈 일련번호와 확인 응답 번호
3-way 핸드셰이크가 끝나고 실제 데이터를 보내거나 상대방이 받을 때는 TCP 헤더의 일련번호(sequence number)와 확인응답번호(acknowledgement number)를 사용한다.

- 일련번호
  - TCP는 데이터를 분할해서 보내는데 일련번호는 송신 측에서 수신 측에 이 데이터가 몇 번째 데이터인지 알려주는 역할을 한다.
  - 수신자는 원래 데이터의 몇 번째 데이터를 받았는지 알 수 있다.
  - 일련번호는 순서, 연속된 번호 라는 뜻이 있다.
- 확인 응답 번호
  - 수신측이 몇 번째 데이터를 수신했는지 송신 측에 알려주는 역할을 한다.
  - 이 번호는 다음 번호의 데이터를 요청하는데도 사용된다.
  - Ex)10번 데이터를 수신하면 11번 데이터를 요청한다.

<img src = "https://github.com/Songdoeon/Book_Study/assets/96420547/0f2701fd-a5ed-4d28-af50-3bd362e74d81" width = 600 height = 500>

<img src = "https://github.com/Songdoeon/Book_Study/assets/96420547/b077b576-cd10-49f1-abaf-18d5caab9408" width = 600 height = 400>

데이터가 항상 올바르게 전달되는 것은 아니므로 일련번호롸 확인 응답 번호를 사용해서 데이터가 손상되거나 유실된 경우 데이터를 재전송하게 되어있다.

이를 재전송 제어 라고한다.

#### 🎈 윈도우 크기
세그먼트 하나를 보낼 때 마다 확인 응답을 반환하면 효율이 높지 않다.

그러므로 TCP 헤더의 윈도우 크기 만큼의 버퍼를 이용하여 데이터를 전송한다.

### 📚 LESSEN 26 : 포트 번호의 구조
---
데이터의 목적지가 어떤 프로그램인지 구분하는 역할을 하는 포트 번호에 대해 알아보자.

#### 🎈 포트 번호
TCP 헤더의 출발지 및 목적지 포트 번호를 이용하여 애플리케이션을 구분한다.

- 포트번호는 0 ~ 65535번을 사용한다.
  - 0 ~ 1023번 포트는 well-known ports이다.
  - well-known ports는 일반적으로 서버측 어플리케이션에서 사용한다.
  - 1024번은 예약되어 있지만 사용되지 않는 포트다.
  - 1025번 이상은 랜덤포트로 클라이언트 측의 송신 포트로 사용된다.


### 📚 LESSEN 27 : UDP 구조
---
전송 계층에서 효율적으로 통신할 수 있도록 돕는 UDP 프로토콜 구조에 대해 알아보자.

#### 🎈 UDP
UDP는 비연결형 통신으로 데이터를 전송할 때 시간이 걸리는 확인 작업을 일일이 하지 않는다.

그러므로, 데이터를 효율적으로 빠르게 보낼 수 있기에 스트리밍 방식의 동영상 서비스 같은곳에 주로 사용된다.

#### 🎈 UDP 헤더
UDP 헤더가 붙은 데이터를 UDP 데이터그램 이라고 한다.

<img src = "https://github.com/Songdoeon/Book_Study/assets/96420547/b1355431-2628-436e-89f0-712cbbda9f5f" width = 400 hieght = 300>

UDP는 신뢰성과 정확성이 필요하지 않아 헤더가 간단하다.

그리고 UDP를 사용하면 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낼 수 있다. 이를 브로드캐스트 라고 한다.
