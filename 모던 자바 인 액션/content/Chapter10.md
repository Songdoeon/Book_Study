## 🌈 Chapter 10 : 람다를 이용한 도메인 전용 언어
<details><summary>정리</summary>
  
```
- DSL의 주요 기능은 개발자와 도메인 전문가 사이의 간격을 좁히는 것이다.
  - 애플리케이션의 비즈니스 로직을 구현하는 코드를 만든 사람이 프로그램이 사용될 비즈니스 필드의 전문 지식을 갖추긴 어렵다.
  - 개발자도 아닌 사람도 이해할 수 있는 언어로 이런 비즈니스 로직을 구현할 수 있다고 해서
  - 도메인 전문가가 프로그래머가 될 수 있는 것은 아니지만 적어도 로직을 읽고 검증하는 역할은 할 수 있다.
- DSL은 크개 내부적(DSL이 사용될 애플리케이션을 개발한 언어를 그대로 활용) DSL과 외부적(직접 언어를 설계해 사용함) DSL로 분류할 수 있다.
  - 내부적 DSL은 개발 노력이 적게 드는 반면 호스팅 언어의 문법 제약을 받는다.
  - 외부적 DSL은 높은 유연성을 제공하지만 구현하기가 어렵다.
- JVM에서 이용할 수 있는 스칼라, 그루비 등의 다른 언어로 다중 DSL을 개발할 수 있다.
  - 이들 언어는 Java보다 유연하며 간결한 편이다.
  - 하지만 이들을 Java와 통합하려면 빌드 과정이 복잡해지며 Java와의 상호 호환성 문제도 생길 수 있다.
- Java의 장황함과 문법적 엄격함 때문에 보통 자바는 내부적 DSL을 개발하는 언어로는 적합하지 않다.
  - 하지만 Java 8의 람다 표현식과 메서드 참조 덕분에 상황이 많이 개선되었다.
- 최신 Java는 자체 API에 작은 DSL을 제공한다.
  - 이들 `Stream`, `Collectors` 클래스 등에서 제공하는 작은 DSL은 특히 컬렉션 데이터의 정렬, 필터링, 변환, 그룹화에 유용하다.
- Java로 DSL을 구현할 때 보통 메서드 체인, 중첩 함수, 함수 시퀀싱 세 가지 패턴이 사용된다.
  - 각각의 패턴은 장단점이 있지만 모든 기법을 한 개의 DSL에 합쳐 장점만을 누릴 수 있다.
- 많은 Java 프레임워크와 라이브러리를 DSL을 통해 이용할 수 있다.
```

</details>

이번 장에서는 DSL에 대해 알아볼 것이다
  > DSL : Domain Specific Languages의 약자로 도메인 전용 언어를 뜻한다.

애플리케이션의 핵심 비즈니스 모델링하는 소프트웨어 영역에서 읽기 쉽고, 이해하기 좋은 코드는 특히 중요하다.    
도메인 전문가는 소프트웨어 개발 프로세스에 참여할 수 있고, 비즈니스 관점에서 소프트웨어를 확인할 수 있다.

그럼으로써 버그와 오해를 미리 방지할 수도 있는 것이다.



## 📚 LESSEN 1 : 도메인 전용 언어
DSL은 특정 비즈니스 도메인의 문제를 해결하려고 만든 언어이다.

회계 전용 스프트웨어 어플리케이션으로 예를 하나 들어보겠다.

비즈니스 도메인에는 통장 입출금 내역서, 계좌 통합 같은 개념이 포함된다.    
이런 문제를 표현할 수 있는 DSL을 만들 수 있다.

자바에서는 도메인을 표현할 수 있는 클래스와 메서드 집합이 필요하다.   
DSL이란 특정 비즈니스 도메인을 인터페이스로 만든 API라고 생각할 수 있다.

그러다보니 범용적으로 쓰기보다는 특정 도메인에 국한되므로 오직 자신의 문제만 해결하도록 집중할 수 있다는 장점이 있다.

하지만 그렇다고 아무렇게나 만들 수는 없다. 다음과 같은것들을 생각해보자.

- 의사 소통의 왕
  - 우리의 코드의 의도가 개발자가 아닌 사람에게도 명확히 전달되어야함
  - 코드의 비즈니스 요구사항 적합성을 판단하는 방법이 된다.
- 한 번 코드를 구현하지만 여러 번 읽는다.
  - 가독성은 유지보수의 핵심이다.
  - 즉, 항상 우리의 동료가 쉽게 이해할 수 있도록 코드를 구현하자.

DSL은 코드의 비즈니스 의도를 명확하게 하고 가독성을 높인다는 점에서 약이 된다.   
반면 DSL 구현은 코드이므로 올바로 검증하고 유지보수해야 하는 책임이 따른다. 

### 🎈 DSL의 장점과 단점
DSL은 다음과 같은 장점을 제공한다.
- 간결함
  - API는 비즈니스 로직을 간편하게 캡슐화하므로 반복을 피할 수 있고 코드를 간결하게 만들 수 있다.
- 가독성
  - 도메인 영역의 용어를 사용하므로 비 도메인 전문가도 코드를 쉽게 이해할 수 있다.
  - 결과적으로 다양한 조직 구성원 간에 코드와 도메인 영역이 공유될 수 있다.
- 유지보수
  - 잘 설계된 DSL로 구현한 코드는 쉽게 유지보수하고 바꿀 수 있다.
  - 유지보수는 비즈니스 관련 코드 즉 가장 빈번히 바뀌는 애플리케이션 부분에 특히 중요하다.
- 높은 수준의 추상화
  - DSL은 도메인과 같은 추상화 수준에서 동작하므로 도메인의 문제와 직접적으로 관련되지 않은 세부 사항을 숨긴다.
- 집중
  - 비즈니스 도메인의 규칙을 표현을 목적으로 설계된 언어이므로, 개발자가 특정 코드에 집중할 수 있다.
  - 결과적으로 생산성이 좋아진다.
- 관심사 분리(Separation of concerns)
  - 지정된 언어로 비즈니스 로직을 표현함으로 애플리케이션의 인프라구조와 관련 문제를 독립적으로 비즈니스 관련 코드에서 집중하기에 용이하다.
  - 결과적으로 유지보수가 쉬운 코드를 구현하게된다.

반면, 다음과 같은 단점도 발생한다.
- DSL 설계의 어려움
  - 간결하게 제한적인 언어에 도메인 지식을 담는 것이 쉬운 작업은 아니다.
- 개발 비용
  - 코드에 DSL을 추가하는 작업은 초기 프로젝트에 많은 비용과 시간이 소모된다.
  - DSL 유지보수와 변경또한 프로젝트에 부담을 주는 요소다.
- 추가 우회 계층
  - DSL은 추가적인 계층으로 도메인 모델을 감싸며 이 때 계층을 최대한 작게 만들어 성능 문제를 회피한다.
- 새로 배워야 하는 언어
  - 요즘은 한 프로젝트에서 여러 언어를 쓴다.
  - 하지만 DSL을 프로젝트에 추가하면서 팀이 배울 언어가 하나 더 늘어난다.
  - 여러 비즈니스 도메인을 다루는 개별 DSL을 사용한다면 그것들을 합치는 것은 쉽지 않은 일이다.
  - 개별 DSL이 독립적으로 진화할 수 있기 때문이다.
- 호스팅 언어 한계
  - 자바는 범용 프로그래밍언어로 장황하고 엄격한 문법을 가졌다.
  - 이런 언어로는 사용자 친화적 DSL을 만들기 어렵다.
  - 성가신 문법의 제약을 받고 읽기 어려워진다.

### 🎈 JVM에서 이용할 수 있는 다른 DSL 해결책
DSL의 카테고리를 구분하는 가장 흔한 방법은 마틴 파울러가 소개한 내부 DSL과 외부 DSL을 나누는 방법이다.

내부 DSL(임베디드 DSL)은 순수 자바 코드 같은 기존 호스팅 언어를 기반으로 구현하는 반면    
스탠드어론(standalone)이라 불리는 외부 DSL은 호스팅 언어와는 독립적으로 자체의 문법을 가진다.

#### 📕 내부 DSL
이 책을 기준으로 내부 DSL은 자바로 구현한 DSL을 의미한다.

자바 8부터는 람다를 적극적으로 활용해 DSL을 구현할 때 장황함을 크게 줄여 신호 대비 잡음 비율을 적정 수준으로 유지하는 DSL을 만들 수 있게 되었다.

순수 자바로 DSL을 구현함으로 다음과 같은 장점을 얻을 수 있다.

- 외부 DSL에 비해 새로운 패턴과 기술을 배워 구현해야하는 번거로움이 줄어들었다.
- 나머지 코드와 함께 DSL을 컴파일할 수 있다.
  - 다른 언어의 컴파일러나, 외부 DSL을 만드는 도구를 사용할 필요가 없어졌다.
- 개발 팀이 새로운 언어나, 익숙치 않은 개발 툴을 배울 필요가 없다.
- DSL 사용자는 기존 자바의 IDE를 이용해 자동 완성, 리팩터링 같은 기능을 그대로 사용할 수 있다.
- 한 개의 언어로 한 개의 도메인 또는 여러 도메인을 대응하지 못해 추가 DSL 개발시 추가 DSL도 쉽게 합칠 수 있다.

#### 📕 다중 DSL
요즘은 `JRuby`, `Jython`, `Kotlin`, `Scala`등 많은 언어들이 JVM에서 실행된다.

위 언어들은 단순하고 쉽게 배울수 있다는 장점도 있으며, 무엇보다 자바보다 젊고 제약이 적으며, 간편한 문법을 지향한다.
 
DSL은 기반 프로그래밍 언어의 영향을 받으므로 간결한 DSL을 위해선 언어의 특성들이 아주 중요하다.    
그래서 위 언어들로 만든 DSL을 같은 JVM에서 구동되는 자바에서 합친다는 것이 다중 DSL의 핵심이다.

하지만 다음과 같은 문제들이 있다.

- 새로운 프로그래밍 언어를 배워야함
  - 멋진 DSL을 위해선 기존 언어의 고급 기능을 사용할 수 있는 충분한 지식이 필요함
- 두 개 이상의 언어가 혼재하므로 여러 컴파일러로 소스를 빌드하도록 빌드 과정을 개선해야한다.
- JVM에서 실행되는 거의 모든 언어가 자바와의 100% 호환을 주장하지만 그렇지 않을 때가 많다.
  - 성능 손실을 이르키기도 한다.
  - 예를 들어 스칼라와 자바 컬렉션은 서로 호환되지 않는다.

#### 📕 외부 DSL
외부 DSL을 구현하기 위해선 자신만의 문법과 구문으로 새 언어를 설계해야 한다.

## 📚 LESSEN 2 : 자바로 DSL을 만드는 패턴과 기법

#### 📕 메서드 체인
- 장점
  - 메서드 체인을 통해 객체를 만든다.
  - 선택형 파라미터와 잘 동작한다.
  - DSL 사용자가 정해진 순서로 메서드를 호출하도록 강제할 수 있다.
- 단점
  - 사용한 파라미터가 빌더 내부로 국한된다.
  - 들여쓰기로한 도메인 객체 계층을 정의한다.
  - 빌드를 연결하는 접착 코드가 필요하다.
  - 빌더를 구현해야만 한다.

#### 📕 중첩된 함수 이용
- 장점
  - 구현의 장황함을 줄인다.
  - 도메인 객체 계층을 반영한다.
- 단점
  - 정적 메서드의 사용이 빈번하다.
  - 이름이 아닌 위치로 인수를 정의한다.
  - 선택형 파라미터 처리시 메서드 오버로딩이 필요함

#### 📕 람다 표현식을 이용한 함수 시퀀싱
- 장점
  - 선택형 파라미터와 잘 동작한다.
  - 정적 메서드를 최소화한다.
  - 람다 중첩을 ㅗ도메인 객체 계층을 반영한다.
  - 빌더의 접착 코드가 없다.
- 단점
  - 구현이 장황하다.
  - 람다식으로 인한 문법적 잡음이 DSL에 존재한다.
