## 🌈 Chapter 8 : 인덱스
인덱스는 DB 쿼리 성능을 언급하며 빼놓을 수 없는 부분이다.

이번 장에서는 MySQL쿼리의 개발이나 튜닝을 설명하기 전에 MySQL에서 사용 가능한 인덱스의 종류 및 특성을 간단히 살펴보겠다.

각 인덱스의 특성과 차이는 상당히 중요하며, 물리 수준의 모델링을 할 때도 중요한 요소가 될 것이다.

아무리 옵티마이저가 발전하고 성능이 개선됐다고 해도 여전히 인덱스에 대한 기본 이해와 지식은 중요하며, 쿼리 튜닝의 기본이 될 것이다.

## 📚 LESSEN 1 : 디스크 읽기 방식
인덱스에만 의존적인 용어는 아니지만, 이번 장에서는 자주 언급되는 **랜덤 I/O**, **순차 I/O** 같은   
디스크 읽기 방식을 먼저 간단히 알아보고 인덱스를 살펴보겠다.

CPU나 메모리는 매우 빠른 속도로 발전했지만 디스크 같은 기계식 장치의 성능은 상당히 제한적으로 발전했다.

그리하여 데이터 저장 매체는 컴퓨터의 가장 느린 부분이기에 DB의 성능은 어떻게 디스크 I/O를 줄이느냐에 관건일 때가 많다.

### 🎈 HDD vs SSD

SSD는 기존의 HDD에서 데이터 저장용 플래터(원판)을 제거하고 그 대신 플래시 메모리를 장착하고 있다.

그래서 원판을 기계적으로 회전시킬 필요가 없어 데이터를 빠르게 읽고 쓸 수 있다.   
그리고 플래시 메모리는 전원이 공급되지 않아도 데이터가 삭제되지 않는다.

하지만 디스크의 헤더를 움직이지 않고 한 번에 많은 데이터를 읽은 순차 I/O에서는    
SSD가 하드 디스크 드라이브보다 조금 빠르거나 거의 비슷한 성능을 보이기도 한다.

하지만 랜덤 I/O는 SSD가 훨씬 빠르고 대부분의 DB서버는 랜덤 I/O의 비중이 높다.

### 🎈 랜덤 I/O vs 순차 I/O
랜덤 I/O라는 표현은 HDD의 플래터를 돌려 읽어야 할 데이터가 저장된 위치로 디스크 헤더를 이동시킨 후 데이터를 읽는것을 의미한다.

순차 I/O 또한 이 작업 과정은 같다. 그렇다면 둘은 무슨 차이가 있을끼?

- 순차 I/O
  - 3개의 페이지를 디스크에 기록할 때 시스템 콜을 한번 요청한다.
  - 즉, 디스크 헤드를 1번 움직였다는 뜻이다.
- 랜덤 I/O
  - 3개의 페이지를 디스크에 기록할 때 시스템 콜을 3번 요청한다.
  - 즉, 디스크 헤드를 세번 움직였다는 뜻이다.

디스크에 데이터를 읽고 쓰는 데 걸리는 시간은 디스크 헤더의 움직임을 줄이는것에서 결정된다.

그래서 여러 번 쓰기 또는 읽기를 요청하는 랜덤 I/O 작업이 작업 부하가 크다.

DB 작업 대부분은 이러한 작은 데이터를 계속 읽고 쓰기 때문에 다음과 같은 기능을 제공한다.

- 그룹 커밋 
- 바이너리 로그 버퍼
- InnoDB 로그 버퍼

디스크 원판이 없는 SSD는 둘의 차이가 없을 것처럼 보이지만, SSD에서도 둘은 차이가 난다.

쿼리를 튜닝해서 랜덤 I/O를 순차 I/O로 바꿔 실행할 방법은 그다지 많지 않다.   

일반적으로 쿼리를 튜닝하는 것은 랜덤 I/O 자체를 줄여주는 것이 목적이라고 할 수 있다.    
여기서 랜덤 I/O를 줄인다는 것은 쿼리를 처리하는 데 꼭 필요한 데이터만 읽도록 쿼리를 개선하는 것을 의미한다.

#### 📌 인덱스 레인지 스캔
인덱스 레인지 스캔은 데이터를 읽기 위해 주로 랜덤 I/O를 사용하며, 풀 테이블 스캔은 순차 I/O를 사용한다.

그래서 큰 테이블의 레코드 대부분을 읽는 작업에서는 인덱스를 사용하지 않고 풀 테이블 스캔을 사용하도록 유도할 때 도 있다.

이는 순차 I/O가 랜덤 I/O보다 훨씬 빨리 많은 레코드를 읽을 수 있기 때문인데,   
이런 형태는 OLTP(On-Line Transaction Processing) 성격의 웹 서비스 보다는 데이터 웨어하우스, 통계 작업에서 주로 사용된다.
