## 🌈 Chapter 15 : 구글 드라이브 설계

<details><summary>정리</summary>
  
```
```

</details>

클라우드 저장소 서비스는 최근 높은 인기를 누리게 된 대표적 클라우드 서비스다.

Ex) 구글 드라이브, 드롭박스. 원드라이브, 아이클라우드 등 

##  📚 1단계 : 문제 이해 및 설계 범위 확정

이번 장에서는 다음의 설계에 집중할 것이다.

- 파일 추가
  - 가장 쉬운 방법은 파일을 구글 드라이브 안으로 떨어트리는 것이다.(drag - and - drop)
- 파일 다운로드
- 여러 단말의 파일 동기화
  - 한 단말에서 파일을 추가하면 다른 단말에도 자동으로 동기화되어야 한다.
- 파일 공유.
- 파일이 편집되거나 삭제되거나 새롭게 공유되었을 때 알림 표시

구글 문서 편집 및 협업 기능 등 여러 사용자가 같은 문서를 동시에 편집할 수 있도록 하는 서비스가 있지만 이 부분은 설계 범위에서 제외한다.

기능적 요구사항 이외에 다음 비-기능적 요구사항을 이해하는 것도 중요하다.

- 안정성
  - 데이터 소실은 발생하면 안 된다.
- 빠른 동기화 속도
  - 파일 동기화에 시간이 너무 많이 걸리면 사용자는 인내심을 잃고 해당 제품을 더 이상 사용하지 않게 될 것이다.
- 네트워크 대역폭
  - 이 제품이 네트워크 대역폭을 불필요하게 많이 소모하는것은 좋지않다.
  - 모바일 데이터 플랜을 사용하는 경우라면 더욱 별로다.
- 규모 확장성
  - 이 시스템은 아주 많은 양의 트래픽도 처리 가능해야 한다.
- 높은 가용성
  - 일부 서버에 장애가 발생하거나, 느려지거나, 네트워크 일부가 끊겨도 시스템은 계속 사용 가능해야 한다.

### 🎈 개략적 추정치
- 가입 사용자는 오천만(50 million)이고 천만 명의 DAU 사용자가 있다고 가정한다.
- 모든 사용자에게 10GB의 무료 저장공간 할당
- 매일 각 사용자가 평균 2개의 파일을 업로드 한다고 가정.
  - 각 파일의 평균 크기는 500KB
- 읽기:쓰기 비율은 1:1
- 필요한 저장공간 총량 = 5천만 사용자 x 10GB x= 500PB(페타바이트)
- 업로드 API QPS = 1천만 사용자 x 2회 업로드 / 24시간 / 3600 초 = 240
- 최대 QPS = QPS x 2 = 480


##  📚 2단계 : 개략적 설계안 제시 및 동의 구하기

이번에는 모든 것을 담은 한 대 서버에서 출발해 점진적으로 천만 사용자 지원이 가능한 시스템으로 발전시켜 나가보도록 하겠다.

우선 아래 구성을 서버 한 대로 시작해보자

- 파일을 올리고 다운로드 하는 과정을 처리할 웹 서버
- 사용자 데이터, 로그인 정보, 파일 정보 등의 메타데이터를 보관할 DB
- 파일을 저장할 저장소 시스템. 파일 저장을 위해 1TB의 공간을 사용할 것이다.

아파치 웹 서버, MySQL를 설치하고 업로드 되는 파일을 저장할 drive 라는 폴더를 준비한다.

drive폴더 안 namespace라 불리는 하위 폴더에 특정 사용자가 올린 파일이 보관된다.

각 파일과 폴더는 그 상대 경로를 네임스페이스 이름과 결합하면 유일하게 식별해 낼 수 있다.

```
- drive
  - user1
    - recipes
    - chicken_soup.txt
  - user2
    - football.move
    - sport.txt
  - user3
    - best_pic_ever.png
```
